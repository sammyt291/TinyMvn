<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Repository - TinyMvn</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .header h1 {
      color: white;
      font-size: 20px;
    }
    
    .header-actions {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      margin-bottom: 24px;
    }
    
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-header h2 {
      font-size: 16px;
      color: #333;
    }
    
    .card-body {
      padding: 20px;
    }
    
    .repo-url {
      background: #f3f4f6;
      padding: 16px 20px;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .repo-url code {
      color: #667eea;
    }
    
    .copy-btn {
      background: #667eea;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .copy-btn:hover {
      background: #5a67d8;
    }
    
    .artifact-grid {
      display: grid;
      gap: 16px;
    }
    
    .artifact-card {
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 20px;
      transition: box-shadow 0.2s;
    }
    
    .artifact-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .artifact-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    
    .artifact-name {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }
    
    .artifact-version {
      background: #10b981;
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
    }
    
    .artifact-coords {
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 12px;
      color: #666;
      margin-bottom: 16px;
    }
    
    .dependency-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .dep-tab {
      padding: 8px 16px;
      border: 1px solid #e5e7eb;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }
    
    .dep-tab:hover {
      background: #f9fafb;
    }
    
    .dep-tab.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    
    .dependency-code {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
    }
    
    .dependency-code pre {
      color: #d4d4d4;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 13px;
      margin: 0;
      white-space: pre-wrap;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #888;
    }
    
    .empty-state h3 {
      font-size: 18px;
      margin-bottom: 8px;
      color: #666;
    }
    
    .empty-state p {
      margin-bottom: 20px;
    }
    
    .empty-state .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
    }
    
    .config-section {
      margin-top: 24px;
    }
    
    .config-section h3 {
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
    }
    
    .config-code {
      background: #f3f4f6;
      padding: 16px;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 13px;
      overflow-x: auto;
    }
    
    .config-code pre {
      margin: 0;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
      background: #10b981;
    }
    
    .notification.visible {
      transform: translateX(0);
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>üì¶ Repository Browser</h1>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="window.location.href='/files'">üìÅ Files</button>
      <button class="btn btn-secondary" onclick="window.location.href='/auth/settings'">‚öôÔ∏è Settings</button>
      <button class="btn btn-secondary" onclick="window.location.href='/auth/logout'">Logout</button>
    </div>
  </header>
  
  <div class="container">
    <!-- Repository URL Card -->
    <div class="card">
      <div class="card-header">
        <h2>Repository URL</h2>
      </div>
      <div class="card-body">
        <div class="repo-url">
          <code id="repoUrl">Loading...</code>
          <button class="copy-btn" onclick="copyRepoUrl()">Copy</button>
        </div>
        
        <div class="config-section">
          <h3>Maven Configuration (pom.xml)</h3>
          <div class="config-code">
            <pre id="mavenConfig">&lt;repositories&gt;
  &lt;repository&gt;
    &lt;id&gt;custom-repo&lt;/id&gt;
    &lt;url&gt;[repository-url]&lt;/url&gt;
  &lt;/repository&gt;
&lt;/repositories&gt;</pre>
          </div>
        </div>
        
        <div class="config-section">
          <h3>Gradle Configuration (build.gradle)</h3>
          <div class="config-code">
            <pre id="gradleConfig">repositories {
    maven { url '[repository-url]' }
}</pre>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Artifacts Card -->
    <div class="card">
      <div class="card-header">
        <h2>Available Artifacts</h2>
      </div>
      <div class="card-body">
        <div class="artifact-grid" id="artifactGrid">
          <div class="empty-state">
            <h3>Loading artifacts...</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="notification" id="notification">Copied to clipboard!</div>
  
  <script>
    let repositoryUrl = '';
    let artifacts = [];
    
    // Initialize
    document.addEventListener('DOMContentLoaded', loadArtifacts);
    
    // Show notification
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.add('visible');
      setTimeout(() => notification.classList.remove('visible'), 2000);
    }
    
    // Copy to clipboard helper
    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (error) {
        console.warn('Unable to copy.', error);
        return false;
      }
    }
    
    // Copy repository URL
    async function copyRepoUrl() {
      if (await copyToClipboard(repositoryUrl)) {
        showNotification('Repository URL copied!');
      }
    }
    
    // Copy dependency
    async function copyDependency(text) {
      if (await copyToClipboard(text)) {
        showNotification('Dependency copied!');
      }
    }
    
    // Load artifacts
    async function loadArtifacts() {
      try {
        const response = await fetch('/repo/api/artifacts');
        const data = await response.json();
        
        repositoryUrl = data.repositoryUrl;
        artifacts = data.artifacts;
        
        // Update repository URL
        document.getElementById('repoUrl').textContent = repositoryUrl;
        
        // Update Maven config
        document.getElementById('mavenConfig').textContent = `<repositories>
  <repository>
    <id>custom-repo</id>
    <url>${repositoryUrl}</url>
  </repository>
</repositories>`;
        
        // Update Gradle config
        document.getElementById('gradleConfig').textContent = `repositories {
    maven { url '${repositoryUrl}' }
}`;
        
        // Render artifacts
        renderArtifacts();
      } catch (err) {
        console.error('Failed to load artifacts:', err);
        document.getElementById('artifactGrid').innerHTML = `
          <div class="empty-state">
            <h3>Failed to load artifacts</h3>
            <p>${err.message}</p>
          </div>
        `;
      }
    }
    
    // Render artifacts
    function renderArtifacts() {
      const grid = document.getElementById('artifactGrid');
      
      if (artifacts.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <h3>No artifacts available</h3>
            <p>Upload a Java project to create an artifact</p>
            <a href="/files" class="btn">Upload Project</a>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = artifacts.map((artifact, index) => `
        <div class="artifact-card">
          <div class="artifact-header">
            <div class="artifact-name">${artifact.name}</div>
            <div class="artifact-version">${artifact.version}</div>
          </div>
          <div class="artifact-coords">
            ${artifact.groupId}:${artifact.artifactId}:${artifact.version}
          </div>
          <div class="dependency-tabs">
            <button class="dep-tab active" onclick="showDep(${index}, 'maven', this)">Maven</button>
            <button class="dep-tab" onclick="showDep(${index}, 'gradle', this)">Gradle</button>
          </div>
          <div class="dependency-code">
            <pre id="dep-${index}">${escapeHtml(artifact.dependency.maven)}</pre>
          </div>
          <button class="copy-btn" style="margin-top: 12px;" onclick="copyDependency(document.getElementById('dep-${index}').textContent)">
            Copy Dependency
          </button>
        </div>
      `).join('');
    }
    
    // Show dependency format
    function showDep(index, type, btn) {
      const artifact = artifacts[index];
      const pre = document.getElementById(`dep-${index}`);
      
      pre.textContent = artifact.dependency[type];
      
      // Update active tab
      btn.parentElement.querySelectorAll('.dep-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
    }
    
    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
